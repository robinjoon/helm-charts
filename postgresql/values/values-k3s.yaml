nameOverride: "postgresql"
fullnameOverride: "postgresql"
namespaceOverride: "postgres"

global:
  defaultStorageClass: "nfs-csi"
  storageClass: "nfs-csi"
# Replication 아키텍처
architecture: replication

metrics:
  enabled: true

auth:
  existingSecret: "postgresql-secret"
  secretKeys:
    adminPasswordKey: postgres-password
    replicationPasswordKey: replication-password

# Primary DB 설정
primary:
  # 메모리 설정
  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 300m
      memory: 512Mi
  # 저장소 설정
  persistence:
    storageClass: "nfs-csi"
    enabled: true
    size: 300Gi
    accessModes:
      - ReadWriteOnce
  # Security Context 설정 (NFS 볼륨 권한 문제 해결)
  podSecurityContext:
    enabled: true
    fsGroup: 1001
    fsGroupChangePolicy: Always
  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
  # Pod Anti-Affinity: Read replica와 다른 노드에 배치
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - read
          topologyKey: kubernetes.io/hostname

# Read Replica 설정
readReplicas:
  # Read replica 개수
  replicaCount: 1
  # 메모리 설정
  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      cpu: 300m
      memory: 512Mi
  # 저장소 설정
  persistence:
    storageClass: "nfs-client"
    enabled: true
    size: 300Gi
    accessModes:
      - ReadWriteOnce
  # Security Context 설정 (NFS 볼륨 권한 문제 해결)
  podSecurityContext:
    enabled: true
    fsGroup: 1001
    fsGroupChangePolicy: Always
  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
  # Pod Anti-Affinity: Primary와 다른 노드에 배치
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - primary
          topologyKey: kubernetes.io/hostname
